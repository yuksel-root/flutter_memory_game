# -------------------------------
# Netlify Build Configuration
# -------------------------------
[build]
  command = "bash ./netlify_build.sh"   # Flutter build script
  publish = "build/web"                 # Output directory to deploy

# -------------------------------
# SPA Redirect
# -------------------------------
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
  force = false   # ensures assets are not overwritten

# -------------------------------
# Headers for security and cache
# -------------------------------
[[headers]]
  for = "/*"
  [headers.values]

    # ---- NO CACHE ----
    Cache-Control = "no-cache, no-store, must-revalidate"
    Pragma = "no-cache"
    Expires = "0"

    # ---- SECURITY HEADERS ----
    Strict-Transport-Security = "max-age=63072000; includeSubDomains; preload"
    X-Frame-Options = "DENY"
    X-Content-Type-Options = "nosniff"
    Referrer-Policy = "strict-origin-when-cross-origin"
    Permissions-Policy = "geolocation=(), microphone=(), camera=()"

    # ---- Flutter Web Content Security Policy (CSP) ----
    Content-Security-Policy = "default-src 'self' https: data: blob:; script-src 'self' https: blob: 'unsafe-inline' 'unsafe-eval' 'wasm-unsafe-eval'; style-src 'self' https: 'unsafe-inline'; img-src 'self' https: data: blob:; media-src 'self' https: data: blob:; connect-src 'self' https: wss: blob:; worker-src 'self' blob:;"

# -------------------------------
# Optional: cache hashed assets (faster loading)
# -------------------------------
[[headers]]
  for = "/assets/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.js"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"
    Content-Type = "application/javascript"

[[headers]]
  for = "/*.wasm"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"
    Content-Type = "application/wasm"
